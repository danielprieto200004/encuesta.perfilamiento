<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realizando Test | UNIMINUTO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 25%, #3b82f6 50%, #2563eb 75%, #1d4ed8 100%); background-size: 400% 400%; animation: gradientShift 15s ease infinite; min-height: 100vh; position: relative; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.2) 0%, transparent 50%); pointer-events: none; z-index: -1; }
        @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        
        /* ESTILOS A√ëADIDOS PARA LAS NUEVAS PANTALLAS Y TRANSICIONES */
        #questionContainer, .overlay { transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out; }
        .intro-card { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOutDown { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        .fade-in-up { animation: fadeInUp 0.5s ease-in-out forwards; }
        .fade-out-down { animation: fadeOutDown 0.5s ease-in-out forwards; }
        /* FIN DE ESTILOS A√ëADIDOS */
        
        .question-card, .section-header { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .question-changing { opacity: 0; transform: scale(0.95); }
        .option-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid rgba(59, 130, 246, 0.2); }
        .option-btn:not(:disabled):hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(59, 130, 246, 0.2); border-color: #3B82F6; }
        .option-btn.selected { background: linear-gradient(135deg, #1E40AF, #3B82F6); color: white; border-color: #1E40AF; transform: translateY(-3px); box-shadow: 0 15px 35px rgba(30, 64, 175, 0.3); }
        .progress-bar-fill { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); background: linear-gradient(90deg, #3B82F6, #1E40AF, #7C3AED); }
        .floating-element { animation: float 6s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .gradient-text { background: linear-gradient(135deg, #1E40AF, #7C3AED); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .submit-btn-ready { background: linear-gradient(135deg, #10B981, #059669); animation: readyPulse 2s infinite; }
        @keyframes readyPulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } }
    </style>
</head>
<body class="text-gray-800">

    <header class="glass-effect shadow-2xl p-4 md:p-6 sticky top-0 z-20">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4 md:gap-0">
            <div class="flex items-center space-x-4 floating-element">
                <img src="logo.png" alt="Logo UNIMINUTO" class="h-20 w-auto">
                <div>
                    <p class="text-xs md:text-sm text-gray-600 font-medium">SymbioTIC - Observatorio Experimental</p>
                </div>
            </div>
            <div class="text-center md:text-right">
                <span class="font-bold text-base md:text-lg gradient-text">Test ADN Estudiantil</span>
                <p class="text-xs md:text-sm text-gray-600">Paso 2: Cuestionario</p>
            </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3 mt-4 md:mt-6 overflow-hidden">
            <div id="progressBar" class="progress-bar-fill h-3 rounded-full" style="width: 0%"></div>
        </div>
        <div class="flex justify-between text-xs text-white mt-2 font-semibold">
            <span>Inicio</span>
            <span id="progressText">0% completado</span>
            <span>Fin</span>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 relative">

        <div id="welcome-overlay" class="overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-30 p-4">
            <div class="intro-card text-center p-8 md:p-12 rounded-2xl shadow-2xl max-w-2xl mx-auto fade-in-up">
                <h2 class="text-3xl md:text-4xl font-extrabold gradient-text mb-4">¬°Est√°s listo/a para comenzar!</h2>
                <p class="text-lg md:text-xl text-gray-600 mb-8">El test consta de 60 preguntas divididas en 3 secciones. No hay respuestas correctas o incorrectas, solo elige la opci√≥n que mejor te represente. ¬°Adelante!</p>
                <button id="start-test-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-xl text-xl transition-transform transform hover:scale-105">Comenzar Test</button>
            </div>
        </div>

        <div id="section-intro" class="overlay fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-30 p-4" style="display: none;">
            <div class="intro-card text-center p-8 md:p-12 rounded-2xl shadow-2xl max-w-2xl mx-auto">
                <div id="intro-section-icon" class="w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-6 text-5xl"></div>
                <h3 id="intro-section-title" class="text-3xl md:text-4xl font-bold gradient-text mb-4"></h3>
                <p id="intro-section-description" class="text-lg md:text-xl text-gray-600 mb-8"></p>
                <button id="continue-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl text-lg transition-transform transform hover:scale-105">Continuar</button>
            </div>
        </div>
        
        <div id="questionContainer" class="max-w-4xl mx-auto" style="display: none;">
            <div id="section-header" class="section-header p-6 md:p-8 rounded-2xl shadow-xl mb-6 md:mb-8">
                <div class="flex flex-col sm:flex-row justify-between items-center text-center sm:text-left gap-4">
                    <div class="flex items-center space-x-4">
                        <div id="sectionIcon" class="w-12 h-12 md:w-16 md:h-16 rounded-2xl flex items-center justify-center flex-shrink-0"></div>
                        <div>
                            <h3 id="sectionTitle" class="text-xl sm:text-2xl md:text-3xl font-bold gradient-text"></h3>
                            <p id="sectionDescription" class="text-gray-600 mt-1 text-sm md:text-lg"></p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="sectionCounter" class="px-4 py-2 rounded-xl">
                            <span id="currentQuestionNum" class="text-xl md:text-2xl font-bold"></span>
                            <span class="text-gray-600">/</span>
                            <span id="totalQuestions" class="text-xl md:text-2xl font-bold">60</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="questionCard" class="question-card p-6 md:p-10 rounded-2xl shadow-2xl mb-8 flex flex-col justify-center">
                <h4 id="questionText" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 text-center leading-relaxed"></h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <button id="optionA" type="button" class="option-btn p-4 md:p-6 rounded-xl flex items-center space-x-4"><div class="w-10 h-10 bg-blue-100 rounded-full flex-shrink-0 flex items-center justify-center"><span class="font-bold text-blue-600 text-xl">A</span></div><span id="optionAText" class="text-base md:text-lg text-left"></span></button>
                    <button id="optionB" type="button" class="option-btn p-4 md:p-6 rounded-xl flex items-center space-x-4"><div class="w-10 h-10 bg-blue-100 rounded-full flex-shrink-0 flex items-center justify-center"><span class="font-bold text-blue-600 text-xl">B</span></div><span id="optionBText" class="text-base md:text-lg text-left"></span></button>
                </div>
            </div>

            <div id="finalSubmit" class="text-center mt-12" style="display: none;">
                <div class="glass-effect p-6 md:p-8 rounded-2xl shadow-2xl inline-block">
                    <h3 class="text-2xl md:text-3xl font-bold gradient-text mb-4">¬°Test Completado!</h3>
                    <p class="text-gray-600 mb-6">Est√°s listo para ver tus resultados.</p>
                    <button id="submitBtn" type="button" class="submit-btn-ready text-white font-bold py-4 px-10 md:py-5 md:px-12 rounded-2xl text-xl md:text-2xl">
                        ¬°Descubre tu perfil!
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // L√ìGICA A√ëADIDA: VARIABLE SEM√ÅFORO PARA PROTECCI√ìN DE CLICS
        let isProcessing = false;
        // --- DATA STORE ---
const surveyData = {
    diagrams: [
        {
            id: "d1",
            questions: [
                {
                    q: "A la hora de inscribir materias electivas, ¬øqu√© pesa m√°s en tu decisi√≥n?",
                    a: "La que me ense√±e una habilidad demandada en el mercado laboral.",
                    b: "La que despierte mi curiosidad y me permita explorar un tema nuevo.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Para ti, ¬øqu√© significa que un profesor es \"excelente\"?",
                    a: "Que tiene experiencia en la industria y enfoca sus clases en las habilidades pr√°cticas.",
                    b: "Que inspira a pensar cr√≠ticamente y fomenta el debate para el desarrollo personal.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øQu√© tipo de examen crees que mide tu nivel de aprendizaje?",
                    a: "Uno que me permita demostrar mi capacidad de proponer soluciones originales.",
                    b: "Uno que mida mi conocimiento sobre el temas vistos en clase con preguntas claras.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© momento de una clase presencial consideras m√°s valioso?",
                    a: "El debate espont√°neo que surge y enriquece el tema desde m√∫ltiples perspectivas.",
                    b: "La explicaci√≥n del profesor que se enfoca en la aplicaci√≥n pr√°ctica de lo aprendido.",
                    val_a: { x: -1, y: 0 },
                    val_b: { x: 1, y: 0 }
                },
                {
                    q: "Piensa en tu principal objetivo al terminar la universidad. ¬øCon cu√°l de estas frases te identificas m√°s?",
                    a: "Asegurar un trabajo estable y buen salario, aunque con reglas laborales tradicionales.",
                    b: "Formarme con una visi√≥n amplia, aunque el desarrollo profesional sea menos directo.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Imagina que tienes dos ofertas para una pr√°ctica universitaria. ¬øCu√°l eliges?",
                    a: "Una empresa competitiva que me exija aunque con carga de trabajo alta y exigente.",
                    b: "Una empresa con un plan de formaci√≥n estructurado, un horario fijo y  jerarqu√≠a clara.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "La universidad ofrece dos programas de intercambio internacional. ¬øCu√°l te llama m√°s la atenci√≥n?",
                    a: "Un programa enfocado en una pasant√≠a intensiva en una empresa multinacional.",
                    b: "Un programa de inmersi√≥n en una comunidad con intercambio cultural y social.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "¬øQu√© habilidad crees que es m√°s crucial desarrollar en la U para tu futuro?",
                    a: "Dominar una t√©cnica, herramienta o software espec√≠fica de mi campo.",
                    b: "Aprender a comunicarme efectivamente y a trabajar en equipos diversos.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øQu√© tipo de evento profesional te atrae m√°s?",
                    a: "Una feria de empleo, enfocada en entregar mi hoja de vida y conseguir entrevistas.",
                    b: "Un conversatorio con egresados para inspirarme y entender el mercado laboral.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Si tuvieras una tarde libre en el universidad, ¬øqu√© actividad preferir√≠as?",
                    a: "Asistir a una charla con un gerente de una empresa sobre tendencias del mercado.",
                    b: "Participar en un taller creativo para vivir experiencias con otros compa√±eros.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Un grupo estudiantil te invita a participar. ¬øCu√°l de estas dos propuestas te atraer√≠a m√°s?",
                    a: "Un grupo para desarrollar proyectos de emprendimiento que exija alta dedicaci√≥n.",
                    b: "Un grupo de trabajo en proyectos aplicados que exija creatividad e intercambio de ideas.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "Al final de tu carrera, ¬øqu√© logro te har√≠a sentir m√°s orgulloso/a?",
                    a: "Haber desarrollado un proyecto innovador, asumiendo el riesgos y recursos propios.",
                    b: "Ser reconocido/a por mi trabajo y dedicaci√≥n, abriendo puertas a becas de posgrado.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "¬øQu√© es lo m√°s valioso que te llevas de un d√≠a en la universidad?",
                    a: "La sensaci√≥n de pertenecer a una comunidad, invirtiendo tiempo en construir relaciones.",
                    b: "Los contactos que hago con personas que pueden ser clave para mi futuro profesional.",
                    val_a: { x: -1, y: 0 },
                    val_b: { x: 1, y: 0 }
                },
                {
                    q: "Cuando te encuentras con un tr√°mite administrativo complicado, ¬øqu√© sueles hacer primero?",
                    a: "Intento resolverlo por mi cuenta, buscando la informaci√≥n en la p√°gina web.",
                    b: "Voy a la oficina correspondiente para que me expliquen el proceso y su soluci√≥n.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "Te das cuenta de que no entiendes un tema clave para el examen final. ¬øQu√© haces?",
                    a: "Dedico varias horas a investigar por mi cuenta. Veo el no entender como un reto personal.",
                    b: "Organizo un grupo de estudio y buscamos una tutor√≠a para reforzar y practicar ejercicios.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "¬øQu√© tipo de apoyo preventivo te parece m√°s √∫til?",
                    a: "Un taller para mejorar mis h√°bitos de estudio y de organizaci√≥n.",
                    b: "Un espacio de escucha y apoyo para manejar la presi√≥n acad√©mica.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© tipo de orientaci√≥n prefieres?",
                    a: "Un mentor que me rete y me impulse a salir de mi zona de confort.",
                    b: "Un tutor que me d√© seguridad y me confirme que voy por buen camino.",
                    val_a: { x: -1, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "Para el proyecto final el profesor solo dice: \"Sorpr√©ndanme\". ¬øCu√°l es tu reacci√≥n inicial?",
                    a: "¬°Genial! Me encanta proponer y aunque no est√©n definidos los entregables.",
                    b: "Uff... preferir√≠a un proyecto con lineamientos claros y entregables definidos.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "Si tienes una idea para mejorar un proceso en la U, ¬øqu√© haces?",
                    a: "La desarrollo y la presento formalmente, asumiendo el liderazgo y el trabajo extra.",
                    b: "Comparto mi idea en los canales oficiales, confiando en que la instituci√≥n la procese.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "Un proyecto en el que trabajaste mucho no da los resultados esperados. ¬øC√≥mo lo ves?",
                    a: "Como una oportunidad de aprendizaje para entender qu√© fall√≥ y mejorar.",
                    b: "Como una ense√±anza de delimitar riesgos y planear futuros proyectos.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: 1, y: -1 }
                }
            ]
        },
        {
            id: "d2",
            questions: [
                {
                    q: "¬øQu√© tipo de curso prefieres m√°s?",
                    a: "Uno con un  gran proyecto semestral que me reta a aplicar conocimientos a un caso real.",
                    b: "Uno con m√≥dulos por contenidos, con talleres y evaluaciones que me midan lo aprendido.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Qu√© profesor consideras que te prepara mejor?",
                    a: "El que resuelve en clase ejercicios pr√°cticos y asegure que sepas aplicar los conceptos.",
                    b: "El que te hace entender la teor√≠a y sus implicaciones, y brinda herramientas para aplicarlos.",
                    val_a: { x: 1, y: -1 },
                    val_b: { x: -1, y: 1 }
                },
                {
                    q: "¬øC√≥mo prefieres recibir la retroalimentaci√≥n de un gran proyecto semestral?",
                    a: "Comentarios puntuales durante el proceso para poder corregir sobre la marcha.",
                    b: "Una o dos entregas detalladas que me brinde una retroalimentaci√≥n espec√≠fica.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "¬øRelacionado con una materia, qu√© situaci√≥n prefieres?",
                    a: "Sacar una buena nota sin tanto esfuerzo a√∫n si no hayas aprendido grandes cosas.",
                    b: "Estudiar mucho y sentir que aprendiste mucho aun si la nota final no sea tan buena.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "¬øQu√© tipo de conocimiento crees que te servir√° m√°s en tu trabajo?",
                    a: "El dominio de herramientas y procesos pr√°cticos que pueda usar desde el primer d√≠a.",
                    b: "Una base conceptual s√≥lida que me explique el porqu√© y c√≥mo adaptarme a  los cambios.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "En una entrevista de trabajo, ¬øqu√© preferir√≠as mostrar?",
                    a: "Un portafolio con proyectos y resultados concretos que he construido.",
                    b: "Mi capacidad para analizar problemas desde una perspectiva estrat√©gica.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øQu√© tipo de taller extracurricular te parece m√°s √∫til?",
                    a: "Uno para aprender una herramienta de tu carrera y con un certificado al final.",
                    b: "Uno sobre pensamiento cr√≠tico y argumentaci√≥n con debates abiertos sin nota.",
                    val_a: { x: 1, y: -1 },
                    val_b: { x: -1, y: 1 }
                },
                {
                    q: "Si debes unirte a uno de estos dos semilleros, ¬øcu√°l eliges?",
                    a: "Uno en el que haya que construir una soluci√≥n, competir en un concurso.",
                    b: "Uno de discusi√≥n sobre temas actuales, ideas innovadoras e implicaciones.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øQu√© tipo de conversaci√≥n acad√©mica disfrutas m√°s con amigos?",
                    a: "Discutir c√≥mo aplicar lo visto en clase para resolver un problema del mundo real.",
                    b: "Debatir  las implicaciones e impactos en la vida cotidiana de un tema visto en clase.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Si buscas ayuda en una tutor√≠a, ¬øqu√© esperas?",
                    a: "Que me gu√≠en paso a paso para resolver los ejercicios espec√≠ficos que no entiendo.",
                    b: "Que me planteen preguntas, me sugieran videos y lecturas para aprender por mi cuenta.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "¬øQu√© tipo de p√°ginas web usas m√°s para estudiar?",
                    a: "Aquellas con videos tutoriales que explican un tema de forma clara y secuencial.",
                    b: "Paginas como foros donde expertos explican y resuelven dudas colaborativamente.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "¬øQu√© tipo de profesor valoras m√°s a lo largo del tiempo?",
                    a: "El profesor exigente que te se√±alo tus errores sin rodeos para forzarte a mejorar.",
                    b: "El profesor que te acompa√±√≥ de cerca, te dio confianza y te ofreci√≥ una estructura.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "Para ti, ¬øqu√© es innovar en la universidad?",
                    a: "Crear un prototipo o producto que funcione y resuelva un problema pr√°ctico.",
                    b: "Desarrollar un nuevo modelo intervenci√≥n que plantee una soluci√≥n original.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: 1 }
                },
                {
                    q: "¬øC√≥mo organizas tu tiempo de estudio?",
                    a: "Me gusta tener un plan de estudio detallado con metas diarias y horarios fijos.",
                    b: "Estudio profundizando en los temas que m√°s me interesan o los mas urgentes.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "Ante un problema sin soluci√≥n clara, ¬øqu√© haces primero?",
                    a: "Busco metodolog√≠as y casos pr√°cticos para tener una base aplicable.",
                    b: "Empiezo a experimentar con diferentes enfoques aceptando cometer errores.",
                    val_a: { x: 1, y: -1 },
                    val_b: { x: -1, y: 1 }
                },
                {
                    q: "¬øQu√© tipo de examen final prefieres?",
                    a: "Uno con preguntas abiertas donde puedes demostrar mi comprensi√≥n.",
                    b: "Uno con preguntas puntuales de lo aprendido y con puntaje definido.",
                    val_a: { x: -1, y: 1 },
                    val_b: { x: 1, y: -1 }
                },
                {
                    q: "¬øQu√© te motiva m√°s a aprender?",
                    a: "La posibilidad de construir algo con mis propias manos y ver que funciona.",
                    b: "La satisfacci√≥n de comprender a una idea sus alcance y sus implicaciones.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Si un profesor quiere que aprendas de un tema por tu cuenta, ¬øqu√© prefieres?",
                    a: "Seguir un tutorial espec√≠fico para aprender una nueva habilidad.",
                    b: "Experimentar con una herramienta aunque no haya una gu√≠a.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "¬øQu√© tipo de trabajo en grupo prefieres?",
                    a: "Uno donde los roles y las tareas de cada integrante sean claros y definidos.",
                    b: "Uno donde el equipo explora el problema en grupo y sin roles definidos.",
                    val_a: { x: 0, y: -1 },
                    val_b: { x: 0, y: 1 }
                },
                {
                    q: "¬øQu√© es m√°s importante para ti en tu carrera?",
                    a: "Que los objetivos de aprendizaje sean pr√°cticos y las evaluaciones puntuales.",
                    b: "Que los temas inviten a la exploraci√≥n de soluciones con informes de resultados.",
                    val_a: { x: 1, y: -1 },
                    val_b: { x: -1, y: 1 }
                }
            ]
        },
        {
            id: "d3",
            questions: [
                {
                    q: "¬øQu√© valoras m√°s de un trabajo en grupo?",
                    a: "La oportunidad de conocer compa√±eros que podr√≠an ser futuros socios o colegas.",
                    b: "El apoyo mutuo y la camarader√≠a que surge al resolver un reto acad√©mico juntos.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: 1 }
                },
                {
                    q: "Un profesor invita a un externo. ¬øQu√© te parece m√°s interesante?",
                    a: "Que sea un alto ejecutivo de una empresa l√≠der para hacer contactos valiosos.",
                    b: "Que sea un l√≠der social o un artista que inspire una reflexi√≥n profunda en la comunidad.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øCu√°l es tu principal objetivo al asistir a un evento universitario?",
                    a: "Conversar con profesores o expertos que puedan potenciar mi carrera.",
                    b: "Relajarme y compartir un buen rato con mi c√≠rculo de amigos cercanos.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "¬øQu√© tipo de programa de mentor√≠a prefieres?",
                    a: "Uno con profesionales exitosos, enfocado en consejos de networking.",
                    b: "Uno con egresados exitosos, enfocado en consejos para lograr mi carrera.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øC√≥mo usas tus redes sociales en el contexto universitario?",
                    a: "Principalmente para construir un perfil profesional.",
                    b: "Principalmente para mantenerme en contacto con mis amigos.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øQu√© te motivar√≠a a ser voluntario en un evento de la universidad?",
                    a: "La posibilidad de conocer a los organizadores y ponentes importantes.",
                    b: "La oportunidad de colaborar con mis amigos y fortalecer nuestros lazos.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "¬øQu√© tipo de evento social prefieres?",
                    a: "Un concierto con toda la facultad, ideal para conocer personas.",
                    b: "Una reuni√≥n peque√±a con tu grupo de amigos de siempre.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "Cuando llegas a un lugar concurrido en el campus, ¬øqu√© haces?",
                    a: "Me muevo entre diferentes grupos participando muchas conversaciones.",
                    b: "Busco un lugar tranquilo y me siento con las personas que tengo confianza.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© te har√≠a sentir m√°s satisfecho/a?",
                    a: "Organizar un gran evento que tenga un impacto masivo y sea recordado en la universidad.",
                    b: "Ser la persona a la que un amigo acude cuando necesita un consejo o apoyo incondicional.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© es m√°s importante para ti en la vida universitaria?",
                    a: "Construir una red de contactos profesionales, aunque las relaciones no sean profundas.",
                    b: "Cultivar unas pocas amistades profundas y significativas, aunque mi red sea peque√±a.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "Cuando requieres armar un equipo de trabajo ¬øC√≥mo sueles escoger?",
                    a: "Busco los mas pilos y me pueden aportar ideas y aprendizajes.",
                    b: "Busco la recomendaci√≥n de amigos y priorizo las personalidades.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "Si te sientes abrumado/a, ¬øqu√© buscas?",
                    a: "Un consejo pr√°ctico de un mentor o profesional que me ayude a enfocarme.",
                    b: "El apoyo emocional de mis amigos para desahogarme y sentir acompa√±ado/a.",
                    val_a: { x: 1, y: -1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "¬øQu√© tipo de espacio f√≠sico valoras m√°s en el campus?",
                    a: "Zonas de coworking y salas de trabajo que faciliten el trabajo en grupo.",
                    b: "Zonas de descanso c√≥modas donde estar con amigos y recargar energ√≠as.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© significa \"bienestar\" para ti en la U?",
                    a: "Tener las herramientas y contactos para sentir seguridad y confianza en mi futuro profesional.",
                    b: "Tener un equilibrio saludable entre lo acad√©mico y lo personal, con una red de apoyo emocional.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øC√≥mo prefieres enterarte de las actividades de la U?",
                    a: "A trav√©s de boletines oficiales o correos para filtrar las oportunidades m√°s relevantes.",
                    b: "A trav√©s de los grupos de WhatsApp con amigos y las conversaciones en los pasillos.",
                    val_a: { x: 1, y: -1 },
                    val_b: { x: -1, y: -1 }
                },
                {
                    q: "Al iniciar cada semestre, ¬øcu√°l es tu principal mentalidad?",
                    a: "Aprovechar√© para conocer personas, participar en eventos y ampliar mis experiencias.",
                    b: "Vengo a lo m√≠o: me enfocar√© en mis clases y en estudiar, las relaciones se van armando.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© tipo de liderazgo te resulta m√°s natural?",
                    a: "Tomar la iniciativa en proyectos, organizar equipos y presentar los resultados.",
                    b: "Apoyar al equipo desde un rol de gesti√≥n, asegurando que todos se sientan incluidos.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "Es la final del torneo de voleibol pero tengo un quiz en clase. ¬øQu√© haces?",
                    a: "Asisto a clase y conf√≠o en mi equipo de voleibol.",
                    b: "Juego la final y asumo la falla en el quiz.",
                    val_a: { x: 1, y: 0 },
                    val_b: { x: -1, y: 0 }
                },
                {
                    q: "¬øCu√°l es tu postura frente a la pol√≠tica estudiantil (representantes, consejos, etc.)?",
                    a: "Me involucro. Es una oportunidad para generar impacto y establecer relaciones.",
                    b: "No me involucro, pero valoro que otros lo hagan. Prefiero enfocarme en mis asuntos.",
                    val_a: { x: 1, y: 1 },
                    val_b: { x: 0, y: -1 }
                },
                {
                    q: "¬øQu√© define mejor tu forma de socializar?",
                    a: "Soy como un \"explorador\": me gusta conocer personas y diferentes ambientes sociales.",
                    b: "Soy como un \"pilar\": prefiero profundizar y enriquecer las relaciones que ya tengo.",
                    val_a: { x: 0, y: 1 },
                    val_b: { x: 0, y: -1 }
                }
            ]
        }
    ],
    answers: {}
};

         document.addEventListener('DOMContentLoaded', () => {
            let currentQuestionIndex = 0;
            let allQuestions = [];
            
            surveyData.diagrams.forEach((diagram, diagramIndex) => {
                diagram.questions.forEach((question, questionIndex) => {
                    allQuestions.push({
                        ...question,
                        diagramIndex,
                        questionId: `${diagram.id}-q${questionIndex}`
                    });
                    surveyData.answers[`${diagram.id}-q${questionIndex}`] = null;
                });
            });

            // DOM Elements
            const qContainer = document.getElementById('questionContainer');
            const qText = document.getElementById('questionText');
            const optA = document.getElementById('optionA');
            const optB = document.getElementById('optionB');
            const optAText = document.getElementById('optionAText');
            const optBText = document.getElementById('optionBText');
            const submitBtn = document.getElementById('submitBtn');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const currentNum = document.getElementById('currentQuestionNum');
            const secTitle = document.getElementById('sectionTitle');
            const secDesc = document.getElementById('sectionDescription');
            const secIcon = document.getElementById('sectionIcon');
            const secCounter = document.getElementById('sectionCounter');
            const finalSubmit = document.getElementById('finalSubmit');

            const sections = [
                { title: 'Tu ADN Estudiantil', description: 'Tu mentalidad y c√≥mo abordas la experiencia universitaria', icon: 'üß¨', gradient: 'from-blue-500 to-indigo-600', counterClass: 'bg-blue-100', textClass: 'text-blue-700' },
                { title: 'Tu Estilo de Aprendizaje', description: 'C√≥mo prefieres procesar y aplicar el conocimiento', icon: '‚úçÔ∏è', gradient: 'from-purple-500 to-pink-600', counterClass: 'bg-purple-100', textClass: 'text-purple-700' },
                { title: 'Tu Forma de Conectar', description: 'C√≥mo te relacionas con otros en la universidad', icon: 'ü§ù', gradient: 'from-green-500 to-teal-600', counterClass: 'bg-green-100', textClass: 'text-green-700' }
            ];

            function updateUI() {
                const question = allQuestions[currentQuestionIndex];
                const section = sections[question.diagramIndex];

                qText.textContent = question.q;
                optAText.textContent = question.a;
                optBText.textContent = question.b;
                
                currentNum.textContent = currentQuestionIndex + 1;
                secTitle.textContent = section.title;
                secDesc.textContent = section.description;
                secIcon.innerHTML = `<span class="text-3xl">${section.icon}</span>`;
                secIcon.className = `w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-r ${section.gradient}`;
                secCounter.className = `px-4 py-2 rounded-xl ${section.counterClass}`;
                currentNum.className = `text-2xl font-bold ${section.textClass}`;
                document.getElementById('totalQuestions').className = `text-2xl font-bold ${section.textClass}`;

                const progress = ((currentQuestionIndex) / allQuestions.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${Math.round(progress)}% completado`;

                optA.classList.remove('selected');
                optB.classList.remove('selected');
            }

            function selectOption(value) {
                surveyData.answers[allQuestions[currentQuestionIndex].questionId] = value;
                const selectedBtn = value === 'a' ? optA : optB;
                selectedBtn.classList.add('selected');

                setTimeout(() => {
                    if (currentQuestionIndex < allQuestions.length - 1) {
                        qContainer.classList.add('question-changing');
                        setTimeout(() => {
                            currentQuestionIndex++;
                            updateUI();
                            qContainer.classList.remove('question-changing');
                        }, 400);
                    } else {
                        // All questions answered
                        progressBar.style.width = `100%`;
                        progressText.textContent = `100% completado`;
                        qContainer.classList.add('question-changing');
                        setTimeout(() => {
                            document.getElementById('questionCard').style.display = 'none';
                            finalSubmit.style.display = 'block';
                            qContainer.classList.remove('question-changing');
                        }, 400);
                    }
                }, 300);
            }

            submitBtn.addEventListener('click', async () => {
                // 1. Obtenemos el id_sesion que guardamos antes
                const id_sesion = sessionStorage.getItem('id_sesion');
                if (!id_sesion) {
                    alert('Error: No se encontr√≥ una sesi√≥n activa. Por favor, regresa al inicio.');
                    return;
                }

                // 2. Preparamos las respuestas para enviar
                const respuestasParaEnviar = Object.keys(surveyData.answers).map(key => {
                    return { id_pregunta: key, respuesta: surveyData.answers[key] };
                });

                try {
                    // 3. Enviamos las respuestas a la API de Python
                    const response = await fetch('https://api-encuesta-uniminuto-v1-e5f2dva8eydqggcm.chilecentral-01.azurewebsites.net/api/guardar-respuestas', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id_sesion: id_sesion, respuestas: respuestasParaEnviar })
                    });
                    
                    if (!response.ok) {
                    const errorData = await response.json(); // Leer el JSON del error
                    throw new Error('Error del servidor: ' + errorData.error); // Mostrar el error real
                    }

                    // 4. Calculamos los resultados para mostrarlos AL ESTUDIANTE (esto no va a la BD)
                    const results = surveyData.diagrams.map(diagram => {
                        let scoreX = 0;
                        let scoreY = 0;
                        diagram.questions.forEach((q, index) => {
                            const questionId = `${diagram.id}-q${index}`;
                            const answer = surveyData.answers[questionId];
                            if (answer === 'a') {
                                scoreX += q.val_a.x;
                                scoreY += q.val_a.y;
                            } else if (answer === 'b') {
                                scoreX += q.val_b.x;
                                scoreY += q.val_b.y;
                            }
                        });
                        return { diagramId: diagram.id, scoreX, scoreY };
                    });
                    localStorage.setItem('surveyResults', JSON.stringify(results)); // Usamos localStorage para la √∫ltima p√°gina

                    // 5. Redirigimos a la p√°gina de resultados
                    window.location.href = 'resultados.html';

                } catch (error) {
                    console.error('Error al guardar respuestas:', error);
                    alert('No se pudieron guardar tus respuestas. Error detallado: ' + error.message);
                }
            });

            optA.addEventListener('click', () => selectOption('a'));
            optB.addEventListener('click', () => selectOption('b'));

            // Initial Load
            if (!sessionStorage.getItem('id_sesion')) { // Verificamos id_sesion en lugar de studentInfo
                alert('No se encontr√≥ una sesi√≥n activa. Redirigiendo al registro.');
                window.location.href = 'index.html';
            } else {
                updateUI();
                setTimeout(() => {
                    qContainer.style.opacity = '1';
                    qContainer.style.transform = 'translateY(0)';
                }, 100);
            }
        });
    </script>
</body>
</html>