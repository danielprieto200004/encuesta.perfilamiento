<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realizando Test | UNIMINUTO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .progress-bar-fill { transition: width 0.6s ease-in-out; }
        .question-container-transition { transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out; }
        .question-changing { opacity: 0; transform: scale(0.98); }
        .option-btn.selected { background-color: #4f46e5; color: white; }
    </style>
</head>
<body class="bg-slate-100 antialiased">

    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <img class="h-8 w-auto" src="logo.png" alt="Logo UNIMINUTO">
                </div>
                <div class="text-right">
                    <h2 class="text-sm font-bold text-slate-800">Test de Perfilamiento</h2>
                    <p class="text-xs text-slate-500">Paso 2: Cuestionario</p>
                </div>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                <div id="progressBar" class="bg-indigo-600 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-xs text-slate-500 mt-1">
                <span id="progressText">0% completado</span>
                <span id="currentQuestionNum" class="font-medium">Pregunta 1 / 60</span>
            </div>
        </div>
    </header>

    <main class="py-12 px-4 sm:px-6 lg:px-8">
        <div id="questionContainer" class="w-full max-w-3xl mx-auto question-container-transition">
            <div id="section-header" class="mb-6 text-center">
                <h3 id="sectionTitle" class="text-2xl font-bold text-slate-900"></h3>
                <p id="sectionDescription" class="text-slate-600 mt-1"></p>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h4 id="questionText" class="text-xl font-semibold text-slate-800 mb-6 text-center min-h-[80px]"></h4>
                <div class="space-y-4">
                    <button id="optionA" type="button" class="option-btn w-full text-left p-4 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors">
                        <span class="font-bold text-indigo-600 mr-2">A)</span>
                        <span id="optionAText"></span>
                    </button>
                    <button id="optionB" type="button" class="option-btn w-full text-left p-4 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors">
                        <span class="font-bold text-indigo-600 mr-2">B)</span>
                        <span id="optionBText"></span>
                    </button>
                </div>
            </div>

            <div id="finalSubmit" class="text-center mt-8 bg-white rounded-2xl shadow-xl p-8" style="display: none;">
                <h3 class="text-2xl font-bold text-slate-900">¬°Test Completado!</h3>
                <p class="text-slate-600 my-4">Est√°s listo para ver tus resultados.</p>
                <button id="submitBtn" type="button" class="w-full sm:w-auto inline-flex justify-center py-3 px-6 border border-transparent text-sm font-semibold rounded-lg text-white bg-green-600 hover:bg-green-700 transition-colors">
                    ¬°Descubre tu perfil!
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- DATA STORE (igual que antes) ---
        const surveyData = {
            diagrams: [
                { id: 'd1', questions: [ { q: 'A la hora de elegir tus materias electivas, ¬øqu√© pesa m√°s en tu decisi√≥n?', a: 'La que me ense√±e una habilidad espec√≠fica muy demandada en el mercado laboral.', b: 'La que despierte mi curiosidad y me permita explorar un tema nuevo.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Para ti, ¬øqu√© significa que un profesor es "excelente"?', a: 'Que tiene experiencia en la industria y enfoca sus clases en las habilidades que las empresas necesitan.', b: 'Que inspira a pensar cr√≠ticamente, fomenta el debate y se preocupa por el desarrollo personal.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øQu√© tipo de evaluaci√≥n te parece m√°s representativa de tu aprendizaje?', a: 'Una que me permita demostrar mi capacidad de investigar y proponer soluciones originales.', b: 'Una que mida mi conocimiento sobre los temas vistos en clase a trav√©s de preguntas claras.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© momento de una clase presencial consideras m√°s valioso?', a: 'El debate espont√°neo que surge y enriquece el tema desde m√∫ltiples perspectivas.', b: 'La explicaci√≥n del profesor que se enfoca en la aplicaci√≥n pr√°ctica para el trabajo.', val_a: {x:-1, y:0}, val_b: {x:1, y:0} }, { q: 'Piensa en tu principal objetivo al terminar la universidad. ¬øCon cu√°l de estas frases te identificas m√°s?', a: '"Asegurar un camino claro hacia la estabilidad y un buen salario, aunque deba enfocarme solo en lo profesional".', b: '"Formarme como una persona con una visi√≥n m√°s amplia, aunque el camino profesional sea menos directo".', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Imagina que tienes dos ofertas para una pr√°ctica universitaria. ¬øCu√°l eliges?', a: 'Una en una startup competitiva con aprendizaje acelerado y autonom√≠a, aunque la carga de trabajo sea alta y exija disponibilidad fuera de horarios.', b: 'Una en una organizaci√≥n con un plan de formaci√≥n estructurado, un horario fijo que respeta mi tiempo personal y un tutor asignado.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: 'La universidad ofrece dos programas de intercambio internacional. ¬øCu√°l te llama m√°s la atenci√≥n?', a: 'Un programa enfocado en una pasant√≠a intensiva en una empresa multinacional.', b: 'Un programa de voluntariado en una comunidad para el intercambio cultural y desarrollo social.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: '¬øQu√© habilidad crees que es m√°s crucial desarrollar en la U para tu futuro?', a: 'Dominar un software o una t√©cnica muy espec√≠fica de mi campo.', b: 'Aprender a comunicarme efectivamente y a trabajar en equipos diversos.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øQu√© tipo de evento profesional te atrae m√°s?', a: 'Una feria de empleo, enfocada en la eficiencia de entregar mi hoja de vida y conseguir entrevistas.', b: 'Un conversatorio con egresados para inspirarme, aunque no ofrezca una oportunidad laboral inmediata.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Si tuvieras una tarde libre en el campus, ¬øqu√© actividad preferir√≠as?', a: 'Asistir a una charla con un gerente de una empresa importante sobre tendencias del mercado.', b: 'Participar en un taller de escritura creativa o en un cine-foro para discutir una pel√≠cula.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Un grupo estudiantil te invita a participar. ¬øCu√°l de estas dos propuestas te atrae m√°s?', a: 'Un grupo para desarrollar proyectos de emprendimiento, que exige alta dedicaci√≥n para competir y buscar financiaci√≥n.', b: 'Un grupo de apoyo y bienestar, donde el foco es crear lazos de amistad y un ambiente de soporte mutuo.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: 'Al final de tu carrera, ¬øqu√© logro te har√≠a sentir m√°s orgulloso/a?', a: 'Haber desarrollado un proyecto innovador, asumiendo el riesgo de invertir tiempo y recursos propios para materializarlo.', b: 'Ser reconocido/a por mis profesores por mi excelencia, abriendo puertas a becas de posgrado o recomendaciones laborales.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: '¬øQu√© es lo m√°s valioso que te llevas de un d√≠a en el campus?', a: 'La sensaci√≥n de pertenecer a una comunidad, invirtiendo tiempo en construir relaciones de amistad y apoyo mutuo.', b: 'Los contactos que hago con personas que pueden ser clave para mi futuro profesional, aunque esto implique ser m√°s estrat√©gico/a.', val_a: {x:-1, y:0}, val_b: {x:1, y:0} }, { q: 'Cuando te encuentras con un tr√°mite administrativo complicado, ¬øqu√© sueles hacer primero?', a: 'Intento resolverlo por mi cuenta, buscando la informaci√≥n en la p√°gina web.', b: 'Voy directamente a la oficina correspondiente para que un funcionario me explique el proceso.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Te das cuenta de que no entiendes un tema clave para el examen final. ¬øQu√© haces?', a: 'Dedico varias horas a investigar por mi cuenta. Veo el no entender como un reto personal.', b: 'Organizo un grupo de estudio y le pido al profesor una tutor√≠a extra para que nos refuerce.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© tipo de apoyo preventivo te parece m√°s √∫til?', a: 'Un taller para mejorar mis h√°bitos de estudio y organizaci√≥n.', b: 'Un espacio de escucha y apoyo emocional para manejar la presi√≥n acad√©mica.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© tipo de orientaci√≥n prefieres?', a: 'Un mentor que me rete y me impulse a salir de mi zona de confort.', b: 'Un tutor que me d√© seguridad y me confirme que voy por el camino correcto.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Tu profesor presenta un proyecto final muy abierto, diciendo: "Sorpr√©ndanme". ¬øCu√°l es tu reacci√≥n inicial?', a: '¬°Genial! Me encanta la libertad para investigar y proponer algo original por mi cuenta.', b: 'Uff... prefiero buscar al profesor para que me d√© lineamientos m√°s claros y ejemplos.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Si tienes una idea para mejorar un proceso en la U, ¬øqu√© haces?', a: 'La desarrollo y la presento formalmente, asumiendo el liderazgo y el trabajo extra que esto implica.', b: 'La comparto en los canales oficiales, confiando en que las estructuras existentes la procesen adecuadamente.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Un proyecto en el que trabajaste mucho no da los resultados esperados. ¬øC√≥mo lo ves?', a: 'Como una oportunidad de aprendizaje valiosa para entender qu√© fall√≥ y mejorar.', b: 'Como una frustraci√≥n que me hace dudar de si deber√≠a tomar tantos riesgos.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, ] },
                { id: 'd2', questions: [ { q: 'Prefieres un curso que se base principalmente en...', a: 'un gran proyecto semestral que te reta a integrar y aplicar conocimientos sobre un caso real.', b: 'm√≥dulos tem√°ticos secuenciales, con talleres y evaluaciones que aseguran el dominio de cada concepto.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øQu√© profesor consideras que te prepara mejor?', a: 'El que resuelve en clase muchos ejercicios pr√°cticos tipo examen, asegurando que sepas c√≥mo aplicar los conceptos.', b: 'El que te hace entender la teor√≠a a la perfecci√≥n, confiando en que t√∫ encontrar√°s la forma de aplicarla.', val_a: {x:1, y:-1}, val_b: {x:-1, y:1} }, { q: '¬øC√≥mo prefieres recibir la retroalimentaci√≥n de un proyecto?', a: 'Comentarios puntuales y frecuentes durante todo el proceso para poder corregir sobre la marcha.', b: 'Una evaluaci√≥n final detallada que me permita ver el resultado global y aprender de √©l para el futuro.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: '¬øQu√© situaci√≥n te generar√≠a m√°s frustraci√≥n a largo plazo?', a: 'Pasar un curso sin mucho esfuerzo, pero luego sentir que no tienes las bases s√≥lidas para el siguiente.', b: 'Estudiar much√≠simo y sentir que aprendiste un mont√≥n, pero que la nota final no lo refleje.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: '¬øQu√© tipo de conocimiento crees que te servir√° m√°s en tu primer trabajo?', a: 'El dominio de herramientas y procesos pr√°cticos que pueda usar desde el primer d√≠a.', b: 'Una base conceptual s√≥lida que me permita entender el porqu√© de las cosas y adaptarme a futuros cambios.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'En una entrevista de trabajo, ¬øqu√© preferir√≠as demostrar?', a: 'Un portafolio con proyectos y resultados concretos que he construido.', b: 'Mi capacidad para analizar problemas complejos desde una perspectiva te√≥rica y estrat√©gica.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øQu√© tipo de taller extracurricular te parece m√°s √∫til?', a: 'Uno para aprender a usar un software espec√≠fico de tu carrera, con un certificado al final.', b: 'Uno sobre pensamiento cr√≠tico y argumentaci√≥n, con debates abiertos y sin una evaluaci√≥n formal.', val_a: {x:1, y:-1}, val_b: {x:-1, y:1} }, { q: 'Si te unes a un club acad√©mico, ¬øcu√°l eliges?', a: 'Un club de rob√≥tica o programaci√≥n para construir, competir y ver resultados tangibles.', b: 'Un club de lectura o filosof√≠a para debatir sobre grandes obras, ideas y sus implicaciones.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øQu√© tipo de conversaci√≥n acad√©mica disfrutas m√°s con amigos?', a: 'Discutir c√≥mo aplicar lo visto en clase para resolver un problema del mundo real.', b: 'Debatir sobre las implicaciones filos√≥ficas o √©ticas de una teor√≠a que vieron en clase.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Si buscas ayuda en una tutor√≠a, ¬øqu√© esperas?', a: 'Que me gu√≠en paso a paso para resolver los ejercicios espec√≠ficos que no entiendo.', b: 'Que me recomienden libros y fuentes para que pueda investigar y entender el tema por mi cuenta.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: '¬øQu√© tipo de recurso en l√≠nea usas m√°s para estudiar?', a: 'Videos tutoriales oficiales que explican un tema de forma clara y secuencial.', b: 'Foros donde otros estudiantes y expertos debaten y resuelven dudas de forma colaborativa.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: '¬øQu√© tipo de gu√≠a de un profesor valoras m√°s a largo plazo?', a: 'La de un profesor exigente que te se√±ala tus errores sin rodeos para forzarte a mejorar y a ser m√°s aut√≥nomo/a.', b: 'La de un profesor que te acompa√±a de cerca, te da confianza y te ofrece una estructura de apoyo constante.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Para ti, innovar en la universidad es...', a: 'crear un prototipo, un plan de negocio o un producto que funcione y resuelva un problema pr√°ctico.', b: 'desarrollar un nuevo modelo te√≥rico o un ensayo que ofrezca una perspectiva original sobre un tema.', val_a: {x:1, y:1}, val_b: {x:-1, y:1} }, { q: '¬øC√≥mo organizas tu tiempo de estudio?', a: 'Me gusta tener un plan de estudio detallado con metas diarias y horarios fijos para cada materia.', b: 'Estudio de forma m√°s org√°nica, profundizando en los temas que m√°s me interesan en el momento.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: 'Ante un problema sin soluci√≥n clara, ¬øqu√© haces primero?', a: 'Busco metodolog√≠as y casos pr√°cticos que otros han usado para tener una base aplicable.', b: 'Empiezo a experimentar con diferentes enfoques conceptuales, aceptando que puedo cometer errores en el proceso.', val_a: {x:1, y:-1}, val_b: {x:-1, y:1} }, { q: '¬øQu√© tipo de examen final prefieres?', a: 'Uno con preguntas abiertas donde puedes demostrar tu comprensi√≥n con tus propias palabras, aunque la calificaci√≥n sea m√°s subjetiva.', b: 'Uno con problemas y preguntas con puntaje definido, donde las reglas de calificaci√≥n son claras y objetivas.', val_a: {x:-1, y:1}, val_b: {x:1, y:-1} }, { q: '¬øQu√© te motiva m√°s a aprender?', a: 'La posibilidad de construir algo con mis propias manos y ver que funciona.', b: 'La satisfacci√≥n de comprender a fondo una idea abstracta y sus implicaciones.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Un profesor te da la opci√≥n de...', a: 'seguir un tutorial detallado para aprender una nueva habilidad y asegurar un resultado correcto.', b: 'experimentar libremente con una nueva tecnolog√≠a, aunque no haya una gu√≠a y el resultado sea incierto.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: '¬øQu√© tipo de trabajo en grupo prefieres?', a: 'Uno donde los roles y las tareas de cada integrante est√°n claramente definidos desde el principio.', b: 'Uno donde el equipo explora el problema de forma conjunta y los roles y soluciones surgen org√°nicamente.', val_a: {x:0, y:-1}, val_b: {x:0, y:1} }, { q: '¬øQu√© es m√°s importante en un syllabus para ti?', a: 'Que los objetivos de aprendizaje sean pr√°cticos y las evaluaciones est√©n claramente definidas.', b: 'Que la bibliograf√≠a sea profunda y los temas inviten a la exploraci√≥n independiente.', val_a: {x:1, y:-1}, val_b: {x:-1, y:1} }, ] },
                { id: 'd3', questions: [ { q: '¬øQu√© valoras m√°s de un trabajo en grupo?', a: 'Trabajar con los compa√±eros m√°s capaces, aunque la din√°mica sea competitiva, para asegurar la mejor nota y aprender de los mejores.', b: 'Trabajar con mis amigos, aunque no sean los m√°s expertos, para asegurar un buen ambiente y apoyarnos mutuamente.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: 'Un profesor invita a un ponente externo. ¬øQu√© te parece m√°s interesante?', a: 'Que sea un alto ejecutivo de una empresa l√≠der para hacer contactos valiosos.', b: 'Que sea un l√≠der social o un artista que inspire una reflexi√≥n profunda en la comunidad.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øCu√°l es tu principal objetivo al asistir a un evento universitario?', a: 'Identificar y conversar con personas (profesores, ponentes) que puedan potenciar mi carrera.', b: 'Relajarme y compartir un buen rato con mi c√≠rculo de amigos cercanos.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: '¬øQu√© tipo de programa de mentor√≠a prefieres?', a: 'Uno con un egresado exitoso en mi campo, enfocado en consejos de carrera y networking.', b: 'Uno con un estudiante de semestres avanzados, enfocado en el apoyo acad√©mico y la adaptaci√≥n a la vida universitaria.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øC√≥mo usas tus redes sociales en el contexto universitario?', a: 'Principalmente para construir un perfil profesional (ej. LinkedIn) y seguir a l√≠deres de la industria.', b: 'Principalmente para mantenerme en contacto con mis amigos y enterarme de eventos sociales y de bienestar.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øQu√© te motivar√≠a a ser voluntario en un evento de la universidad?', a: 'La posibilidad de tener un rol visible y conocer a los organizadores y ponentes importantes.', b: 'La oportunidad de colaborar con mis amigos en una causa com√∫n y fortalecer nuestros lazos.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: '¬øQu√© tipo de evento social prefieres?', a: 'Una fiesta grande o un concierto con toda la facultad, ideal para conocer mucha gente nueva.', b: 'Una reuni√≥n peque√±a en la cafeter√≠a o una salida a comer con tu grupo de amigos de siempre.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Cuando llegas a un lugar concurrido en el campus, ¬øqu√© haces?', a: 'Me muevo entre diferentes grupos, saludando a varias personas y participando en distintas conversaciones.', b: 'Busco un lugar tranquilo o me siento con las una o dos personas con las que tengo m√°s confianza.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© te har√≠a sentir m√°s satisfecho/a?', a: 'Organizar un gran evento que tenga un impacto masivo y sea recordado por todos en la universidad.', b: 'Ser la persona a la que un amigo acude cuando necesita un consejo o apoyo incondicional.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© es m√°s importante para ti en la vida universitaria?', a: 'Construir una amplia red de contactos que me sirva profesionalmente, aunque las relaciones sean m√°s superficiales.', b: 'Cultivar unas pocas amistades profundas y significativas, aunque mi red de contactos sea m√°s peque√±a.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øC√≥mo te unes a un nuevo grupo o club?', a: 'Investigo cu√°les son los m√°s prestigiosos o los que ofrecen mejores oportunidades y me presento activamente.', b: 'Espero a que un amigo me invite o me uno a uno donde ya conozco a varias personas.', val_a: {x:1, y:1}, val_b: {x:-1, y:-1} }, { q: 'Si te sientes abrumado/a, ¬øqu√© buscas?', a: 'Un consejo pr√°ctico de un mentor o profesional que me ayude a enfocarme en soluciones para mi carrera.', b: 'El apoyo emocional de mis amigos para desahogarme y sentir que no estoy solo/a en esto.', val_a: {x:1, y:-1}, val_b: {x:-1, y:-1} }, { q: '¬øQu√© tipo de espacio f√≠sico valoras m√°s en el campus?', a: 'Zonas de coworking y salas de reuniones que faciliten la interacci√≥n y el trabajo con diversos grupos.', b: 'Zonas de descanso c√≥modas y silenciosas donde pueda estar solo/a o con un amigo para recargar energ√≠as.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© significa "bienestar" para ti en la U?', a: 'Tener las herramientas y contactos para sentir seguridad y confianza en mi futuro profesional.', b: 'Tener un equilibrio saludable entre lo acad√©mico y lo personal, con una red de apoyo emocional fuerte.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øC√≥mo prefieres enterarte de las actividades de la U?', a: 'A trav√©s de boletines oficiales y redes profesionales para filtrar las oportunidades m√°s relevantes para mi carrera.', b: 'A trav√©s de los grupos de WhatsApp con mis amigos y las conversaciones en los pasillos.', val_a: {x:1, y:-1}, val_b: {x:-1, y:-1} }, { q: 'Al iniciar cada semestre, ¬øcu√°l es tu mentalidad principal?', a: '"Aprovechar√© para conocer gente nueva, participar en eventos y ampliar mis experiencias m√°s all√° de lo acad√©mico".', b: '"Vengo a lo m√≠o: me enfocar√© en mis clases y en estudiar, las relaciones sociales ya se dar√°n con el tiempo".', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© tipo de liderazgo te resulta m√°s natural?', a: 'Tomar la iniciativa en proyectos, organizar equipos y presentar los resultados frente a audiencias.', b: 'Apoyar al equipo desde un rol m√°s discreto, asegurando que todos se sientan incluidos y escuchados.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, { q: 'Es la final del torneo de la facultad y coincide con una clase que tiene un quiz de bajo puntaje. ¬øQu√© haces?', a: 'Priorizo mi responsabilidad acad√©mica y asisto a clase, aunque me duela perderme la final.', b: 'Juego la final. Es un momento √∫nico para el equipo y la comunidad, y asumo el riesgo del quiz.', val_a: {x:1, y:0}, val_b: {x:-1, y:0} }, { q: '¬øCu√°l es tu postura frente a la pol√≠tica estudiantil (representantes, consejos, etc.)?', a: 'Me involucro. Es una oportunidad clave para generar impacto y establecer relaciones con las directivas.', b: 'No me involucro, pero valoro que otros lo hagan. Prefiero enfocarme 100% en mis estudios y proyectos.', val_a: {x:1, y:1}, val_b: {x:0, y:-1} }, { q: '¬øQu√© define mejor tu forma de socializar?', a: 'Soy como un "explorador": me gusta conocer gente diversa y adaptarme a diferentes ambientes sociales.', b: 'Soy como un "jardinero": prefiero cuidar y profundizar las pocas relaciones que ya tengo.', val_a: {x:0, y:1}, val_b: {x:0, y:-1} }, ] }
            ],
            answers: {}
        };

        document.addEventListener('DOMContentLoaded', () => {
            let currentQuestionIndex = 0;
            let allQuestions = [];
            
            surveyData.diagrams.forEach((diagram, diagramIndex) => {
                diagram.questions.forEach((question, questionIndex) => {
                    allQuestions.push({
                        ...question,
                        diagramIndex,
                        questionId: `${diagram.id}-q${questionIndex}`
                    });
                    surveyData.answers[`${diagram.id}-q${questionIndex}`] = null;
                });
            });

            // DOM Elements
            const qContainer = document.getElementById('questionContainer');
            const qText = document.getElementById('questionText');
            const optA = document.getElementById('optionA');
            const optB = document.getElementById('optionB');
            const optAText = document.getElementById('optionAText');
            const optBText = document.getElementById('optionBText');
            const submitBtn = document.getElementById('submitBtn');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const currentNum = document.getElementById('currentQuestionNum');
            const secTitle = document.getElementById('sectionTitle');
            const secDesc = document.getElementById('sectionDescription');
            const secIcon = document.getElementById('sectionIcon');
            const secCounter = document.getElementById('sectionCounter');
            const finalSubmit = document.getElementById('finalSubmit');

            const sections = [
                { title: 'Tu ADN Estudiantil', description: 'Tu mentalidad y c√≥mo abordas la experiencia universitaria', icon: 'üß¨', gradient: 'from-blue-500 to-indigo-600', counterClass: 'bg-blue-100', textClass: 'text-blue-700' },
                { title: 'Tu Estilo de Aprendizaje', description: 'C√≥mo prefieres procesar y aplicar el conocimiento', icon: '‚úçÔ∏è', gradient: 'from-purple-500 to-pink-600', counterClass: 'bg-purple-100', textClass: 'text-purple-700' },
                { title: 'Tu Forma de Conectar', description: 'C√≥mo te relacionas con otros en la universidad', icon: 'ü§ù', gradient: 'from-green-500 to-teal-600', counterClass: 'bg-green-100', textClass: 'text-green-700' }
            ];

            function updateUI() {
                const question = allQuestions[currentQuestionIndex];
                const section = sections[question.diagramIndex];

                qText.textContent = question.q;
                optAText.textContent = question.a;
                optBText.textContent = question.b;
                
                currentNum.textContent = currentQuestionIndex + 1;
                secTitle.textContent = section.title;
                secDesc.textContent = section.description;
                secIcon.innerHTML = `<span class="text-3xl">${section.icon}</span>`;
                secIcon.className = `w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-r ${section.gradient}`;
                secCounter.className = `px-4 py-2 rounded-xl ${section.counterClass}`;
                currentNum.className = `text-2xl font-bold ${section.textClass}`;
                document.getElementById('totalQuestions').className = `text-2xl font-bold ${section.textClass}`;

                const progress = ((currentQuestionIndex) / allQuestions.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${Math.round(progress)}% completado`;

                optA.classList.remove('selected');
                optB.classList.remove('selected');
            }

            function selectOption(value) {
                surveyData.answers[allQuestions[currentQuestionIndex].questionId] = value;
                const selectedBtn = value === 'a' ? optA : optB;
                selectedBtn.classList.add('selected');

                setTimeout(() => {
                    if (currentQuestionIndex < allQuestions.length - 1) {
                        qContainer.classList.add('question-changing');
                        setTimeout(() => {
                            currentQuestionIndex++;
                            updateUI();
                            qContainer.classList.remove('question-changing');
                        }, 400);
                    } else {
                        // All questions answered
                        progressBar.style.width = `100%`;
                        progressText.textContent = `100% completado`;
                        qContainer.classList.add('question-changing');
                        setTimeout(() => {
                            document.getElementById('questionCard').style.display = 'none';
                            finalSubmit.style.display = 'block';
                            qContainer.classList.remove('question-changing');
                        }, 400);
                    }
                }, 300);
            }

            submitBtn.addEventListener('click', async () => {
                // 1. Obtenemos el id_sesion que guardamos antes
                const id_sesion = sessionStorage.getItem('id_sesion');
                if (!id_sesion) {
                    alert('Error: No se encontr√≥ una sesi√≥n activa. Por favor, regresa al inicio.');
                    return;
                }

                // 2. Preparamos las respuestas para enviar
                const respuestasParaEnviar = Object.keys(surveyData.answers).map(key => {
                    return { id_pregunta: key, respuesta: surveyData.answers[key] };
                });

                try {
                    // 3. Enviamos las respuestas a la API de Python
                    const response = await fetch('https://api-encuesta-uniminuto-v1-e5f2dva8eydqggcm.chilecentral-01.azurewebsites.net/api/guardar-respuestas', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id_sesion: id_sesion, respuestas: respuestasParaEnviar })
                    });
                    
                    if (!response.ok) {
                    const errorData = await response.json(); // Leer el JSON del error
                    throw new Error(errorData.error); // Mostrar el error real del servidor
                    }

                    // 4. Calculamos los resultados para mostrarlos AL ESTUDIANTE (esto no va a la BD)
                    const results = surveyData.diagrams.map(diagram => {
                        let scoreX = 0;
                        let scoreY = 0;
                        diagram.questions.forEach((q, index) => {
                            const questionId = `${diagram.id}-q${index}`;
                            const answer = surveyData.answers[questionId];
                            if (answer === 'a') {
                                scoreX += q.val_a.x;
                                scoreY += q.val_a.y;
                            } else if (answer === 'b') {
                                scoreX += q.val_b.x;
                                scoreY += q.val_b.y;
                            }
                        });
                        return { diagramId: diagram.id, scoreX, scoreY };
                    });
                    localStorage.setItem('surveyResults', JSON.stringify(results)); // Usamos localStorage para la √∫ltima p√°gina

                    // 5. Redirigimos a la p√°gina de resultados
                    window.location.href = 'resultados.html';

                } catch (error) {
                    console.error('Error al guardar respuestas:', error);
                    alert('No se pudieron guardar tus respuestas. Error detallado: ' + error.message);
                }
            });

            optA.addEventListener('click', () => selectOption('a'));
            optB.addEventListener('click', () => selectOption('b'));

            // Initial Load
            if (!sessionStorage.getItem('id_sesion')) { // Verificamos id_sesion en lugar de studentInfo
                alert('No se encontr√≥ una sesi√≥n activa. Redirigiendo al registro.');
                window.location.href = 'index.html';
            } else {
                updateUI();
                setTimeout(() => {
                    qContainer.style.opacity = '1';
                    qContainer.style.transform = 'translateY(0)';
                }, 100);
            }
        });
    </script>
</body>
</html>



